alloy:
  configMap:
    create: true
    name: alloy-config
    data:
      config.river: |
        // ====================
        // Kubernetes Discovery
        // ====================
        discovery.kubernetes "nodes" {
          role = "node"
        }

        discovery.kubernetes "pods" {
          role = "pod"
        }

        // ====================
        // Metrics Scraping
        // ====================
        prometheus.scrape "kubelet" {
          targets = discovery.kubernetes.nodes.targets
          forward_to = [prometheus.remote_write.default.receiver]
        }

        prometheus.scrape "pods" {
          targets = discovery.kubernetes.pods.targets
          forward_to = [prometheus.remote_write.default.receiver]
        }

        prometheus.scrape "aspire" {
          targets = [
            {
              __address__ = "aspire-app.namespace.svc.cluster.local:8080"
            }
          ]
          forward_to = [prometheus.remote_write.default.receiver]
        }

        prometheus.remote_write "default" {
          endpoint {
            // ðŸ‘‡ If you still want to send metrics somewhere
            url = "http://my-kube-prometheus-stack-prometheus.monitoring:9090/api/v1/write"
          }
        }

        // ====================
        // Logs to Loki
        // ====================
        loki.write "default" {
          endpoint {
            url = "http://loki-write.loki-testing:3100/loki/api/v1/push"
          }
        }

        // Read logs from container runtime (CRI)
        loki.source.kubernetes "pods" {
          targets    = discovery.kubernetes.pods.targets
          forward_to = [loki.write.default.receiver]
        }
